<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayMana</title>

    <link rel="stylesheet" href="paymana.css"/>
    <!-- 제이쿼리 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- 테일윈드 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.1.4/tailwind.min.css">

    <!-- 폰트어썸 불러오기 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
</head>
<body>
<div class="container">
    <div class="header">
        <h1>PayMana</h1>
        <label>
            <input type="text" id="title" class="title" value="제목">
            <button class="button">수정</button>
        </label>
    </div>

    <div class="section">
        <div class="row">
            <span>총 예산</span><span>총 지출</span><span>잔액</span>
        </div>
        <div class="row">
            <span class="totalFee total-amount">0원</span>
            <span class="totalSpent total-amount">0원</span>
            <span class="remainingAmount total-amount">0원</span>
        </div>
    </div>

    <div class="flex-container">
        <div class="section">
            <div class="row">
                <span>항목</span><span>금액(원)</span><span></span><span>기타</span>
            </div>

            <div class="item-list">
                <div class="item row">
                    <label>
                        <input class="itemName" type="text">
                    </label>
                    <label>
                        <input class="amount" type="number">
                    </label>
                    <span class="splitAmount"></span>
                    <button class="button" onclick="addItem()">추가</button>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="row">
                <span>이름</span><span>정산금액</span><span>미리낸금액</span><span>기타</span>
            </div>

            <div class="person-list">
                <div class="person row">
                    <label>
                        <input class="name" type="text">
                    </label>
                    <span class="settledAmount">0원</span>
                    <label>
                        <input class="advanceAmount" type="number">
                    </label>
                    <button class="button" onclick="addPerson()">추가</button>
                </div>
            </div>
        </div>
    </div>
    <div class="flex gap-2">
        <button class="button" onclick="location.reload()">정산</button>
        <button class="remove-button" onclick="removePost()">삭제</button>
    </div>
</div>

<div class="footer">
    <p>© 2025 PayMana. All Rights Reserved.</p>
</div>

<script>
    const params = new URLSearchParams(window.location.search);
    const title = params.keys().next().value;


    if (title === '') {
        alert(`잘못된 접근방식입니다.`);
        history.back();
    }

    function titleUpdate() {
        $('.title').val(title);
    }

    titleUpdate();

    function removePost() {
        const deleteCheck = confirm('정말로 삭제하시겠습니까? \n삭제 시 복구가 불가능합니다.');

        if (deleteCheck) {
            localStorage.removeItem(`PM-${title}`);
            window.location.href = `../paymana`;
        }
    }

    const postString = localStorage.getItem(`PM-${title}`);
    const post = postString ? JSON.parse(postString) : {};

    let lastItemId = 0;
    let lastPersonId = 0;

    function addItem() {
        const newItem = `
        <div class="item row">
            <label>
                <input class="itemName" type="text">
            </label>
            <label>
                <input class="amount" type="number">
            </label>
            <span class="splitAmount"></span>
            <button class="remove-bt">🗑</button>
            <input class="id" type="hidden" value="i${lastItemId + 1}">
        </div>
        `;
        $('.item-list').append(newItem);
        lastItemId++;
    }

    function addPerson() {
        const newItem = `
        <div class="person row">
            <label>
                <input class="name" type="text">
            </label>
            <span class="settledAmount">0원</span>
            <label>
                <input class="advanceAmount" type="number">
            </label>
            <button class="remove-bt">🗑</button>
            <input class="id" type="hidden" value="p${lastPersonId + 1}">
        </div>
        `;
        $('.person-list').append(newItem);
        lastPersonId++;
    }

    $(document).on('click', '.remove-bt', function () {
        $(this).closest('div').remove();
    });

    function getLocalStorageSize() {
        let total = 0;
        for (let key in localStorage) {
            if (localStorage.hasOwnProperty(key)) {
                total += (localStorage[key].length * 2); // UTF-16 문자당 2바이트
            }
        }
        console.log(`현재 로컬스토리지 사용량: ${total / 1024} KB`);
    }

    getLocalStorageSize();

</script>
</body>
</html>
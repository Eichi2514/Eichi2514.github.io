<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>AscentLime(test)</title>

    <link rel="stylesheet" href="ascentlime/ascentlime.css"/>
    <!-- 제이쿼리 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- 테일윈드 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.1.4/tailwind.min.css">

    <!-- 폰트어썸 불러오기 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <style>
        @import url("https://fastly.jsdelivr.net/npm/galmuri@latest/dist/galmuri.css");
    </style>
</head>
<body>
<div class="motivation_wrapper">
    <div class="motivation_container"></div>
</div>
<div class="body">
    <a class="logo absolute cursor-pointer" href="">
        <img class="logo" src="https://github.com/user-attachments/assets/19a18684-da40-4693-a6db-81039eebb6e2"
             alt="로고 이미지"/>
    </a>

    <!-- p2 홈페이지 배경 -->
    <img class="bg_img" src="https://github.com/user-attachments/assets/57d5f274-24c1-486b-9679-7aa7b6fa9017"
         alt="배경 이미지"/>

    <!-- p2 두루마리 -->
    <div class="TOP3 absolute">
        <img class="TOP3_img absolute"
             src="https://github.com/user-attachments/assets/2ad87f22-47df-4929-9e1d-10b172cb3aa7"
             alt="두루마리 이미지"/>

        <table class="TOP3_table absolute">
            <caption style="padding-bottom: 1vh;">TOP 3</caption>
            <tbody>
            </tbody>
        </table>
        <a class="TOP3_list_bt absolute z-30" href="../ascentlime/scoreboard">리스트</a>
    </div>
    <!-- 로그아웃 상태일 경우 -->
    <div class="logout">
        <form method="POST">
            <label>
                <input class="id absolute text-center" type="text" placeholder="아이디를 입력해주세요" name="loginId"/>
            </label>
            <label>
                <input class="pw absolute text-center" type="password" placeholder="비밀번호를 입력해주세요" name="loginPw"/>
            </label>

            <a class="join_bt button absolute" href="../ascentlime/member/join">회원가입</a>
            <div>
                <button class="login_bt button login_out_bt absolute" type="submit">로그인</button>
            </div>
        </form>
    </div>
    <!-- 로그인 상태일 경우 -->
    <div class="login hidden">
        <div class="member_name1 absolute text-center">Tester님</div>
        <div class="member_name2 absolute text-center">환영합니다</div>
        <div class="start absolute cursor-pointer">
            <a class="start-text absolute" href="../ascentlime/map/map">게임시작</a>
            <!-- p2 게임시작 호버 전 -->
            <i class="fa-solid fa-square-up-right arrow1 absolute"></i>
            <i class="fa-solid fa-square-up-right arrow2 absolute"></i>
            <img class="start-1"
                 src="https://github.com/user-attachments/assets/dddce550-c44d-45df-adfb-479191d45307"
                 alt="게임 시작 버튼"/>
            <!-- p2 게임시작 호버 후 -->
            <img class="start-2"
                 src="https://github.com/user-attachments/assets/7afa0678-efe6-4107-ab0f-a154bd841994"
                 alt="게임 시작 버튼"/>
        </div>
        <a class="join_bt button absolute" href="../ascentlime/restricted/restricted">내 정 보</a>
        <div>
            <button class="logout_bt button login_out_bt absolute">로그아웃</button>
        </div>
    </div>

    <!-- 메뉴바
    <div class="menu-bg">
        <div class="menu-container">
            <ul class="menu">
                <li class="submenu-container ">
                    <a href="ascentlime/community/main">
                        <div class="button menu-item">커뮤니티</div>
                    </a>
                    <ul class="submenu">
                        <li>
                            <a href="ascentlime/community/main?boardId=1">
                                <div class="button submenu-item">공지사항</div>
                            </a>
                        </li>
                        <li>
                            <a href="ascentlime/community/main?boardId=2">
                                <div class="button submenu-item">자유게시판</div>
                            </a>
                        </li>
                        <li>
                            <a href="ascentlime/community/main?boardId=3">
                                <div class="button submenu-item">Q & A</div>
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div> -->

    <button class="localStorageClear absolute" onclick="localStorage.clear(); alert('초기화 되었습니다.'); location.reload();">
        초기화
    </button>
</div>
<script type="module">
    // Firebase SDK 불러오기
    import {initializeApp} from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
    import {
        getDatabase,
        ref,
        query,
        orderByChild,
        equalTo,
        limitToFirst,
        get
    } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-database.js";

    // Firebase 설정
    const firebaseConfig = {
        apiKey: ".env/apiKey",
        authDomain: ".env/authDomain",
        databaseURL: "https://test-948ba-default-rtdb.firebaseio.com",
        projectId: ".env/projectId",
        storageBucket: ".env/storageBucket",
        messagingSenderId: ".env/messagingSenderId",
        appId: ".env/appId",
        measurementId: ".env/measurementId"
    };

    // Firebase 초기화
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const logsRef = ref(database, 'logs');
    const membersRef = ref(database, 'members');

    window.updateTop3Table = async function () {
        try {
            const logsQuery = query(logsRef, limitToFirst(3));
            const snapshot = await get(logsQuery);

            if (!snapshot.exists()) {
                console.log('No data available');
                return;
            }

            const logs = [];
            snapshot.forEach((childSnapshot) => {
                logs.push(childSnapshot.val());
            });

            // 테이블 요소 선택
            const tableBody = document.querySelector(".TOP3_table tbody");

            // 기존 데이터 제거
            while (tableBody.rows.length > 1) {
                tableBody.deleteRow(1);
            }

            // 상위 3개 데이터 추가
            logs.forEach((log) => {
                const row = tableBody.insertRow();
                row.insertCell().textContent = log.room === 0 ? (log.floor + 1) + '층' : log.floor + '층';
                row.insertCell().textContent = log.room === 0 ? '보스방' : log.room + '번방';
                row.insertCell().textContent = `${log.clearTime}초`;
            });

        } catch (error) {
            console.error("Error fetching data: ", error);
        }
    };

    window.loginIdCheck = async function (loginId) {
        const queryRef = query(membersRef, orderByChild("loginId"), equalTo(loginId));
        try {
            const snapshot = await get(queryRef);
            if (!snapshot.exists()) {
                console.log('해당 아이디를 찾을 수 없습니다.');
                return null;
            }

            const memberData = snapshot.val();

            const memberKey = Object.keys(memberData)[0];
            return memberData[memberKey];
        } catch (error) {
            console.error("로그인 아이디 확인 중 오류 발생:", error);
            return null;
        }
    };

    window.loginKeyCheck = async function (key) {
        const queryRef = query(membersRef, orderByChild("key"), equalTo(key));
        try {
            const snapshot = await get(queryRef);
            if (!snapshot.exists()) {
                console.log('해당 아이디를 찾을 수 없습니다.');
                return null;
            }

            const memberData = snapshot.val();

            const memberKey = Object.keys(memberData)[0];
            return memberData[memberKey].nickname;
        } catch (error) {
            console.error("로그인 아이디 확인 중 오류 발생:", error);
            return null;
        }
    };

    updateTop3Table();
</script>
<script src="ascentlime/ascentlime.js" defer></script>
</body>
</html>
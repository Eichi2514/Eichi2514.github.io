<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë°”ë¦¬ìŠ¤íƒ€</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="icon" href="../../favicon/Eichi2.png" type="image/png">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="../manifest.json">
    <link rel="apple-touch-icon" href="../../favicon/Eichi2.png">

    <!-- Pretendard ì›¹í°íŠ¸ CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">

    <link rel="stylesheet" href="../theme/theme.css">
    <link rel="stylesheet" href="../common/common.css">
    <style>
        .mainPage, .subPage {
            display: flex;
            flex-direction: column; /* ì„¸ë¡œ ì •ë ¬ */
            justify-content: flex-start; /* ìœ„ìª½ë¶€í„° ë°°ì¹˜ */
            gap: 10px;
        }

        /* ì…ë ¥ / ê²€ìƒ‰ ì˜ì—­ */
        /* ===== ì…ë ¥/ê²€ìƒ‰ ì˜ì—­ ===== */
        #controlBar {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .input-groups {
            display: flex;
            gap: 8px;
        }

        /* ê°œë³„ ì…ë ¥ ì¹´ë“œ */
        .input-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-sub);
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            padding: 10px 14px;
            border: 1px solid var(--border-main);
            transition: 0.2s ease;
            gap: 8px;
            width: 50%;
        }

        .input-group span {
            color: var(--primary);
            font-weight: 600;
            flex-shrink: 0;
        }

        .input-group input,
        .input-group select {
            border: none;
            outline: none;
            width: 50%;
            padding: 6px 8px;
            border-radius: 6px;
            background: var(--bg-main);
            color: var(--text-main);
            transition: all 0.2s ease;
            font-size: 16px;
        }

        .input-group input {
            text-align: center;
        }

        .input-group select option {
            white-space: nowrap;
            overflow: visible;
            text-overflow: unset;
            min-width: max-content;
        }

        /* ê²€ìƒ‰ input */
        #searchInput {
            border: 1px solid var(--border-sub);
            border-radius: 10px;
            padding: 12px 14px;
            font-size: 16px;
            font-weight: 600;
            background: var(--bg-sub);
            transition: 0.2s;
            width: 100%;
        }

        #searchInput:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(90, 67, 152, 0.15);
        }

        /* ë²„í”„ í—¤ë” */
        .buff-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        /* í™”ì‚´í‘œ */
        .buff-toggle {
            font-size: 14px;
            color: var(--primary);
        }

        /* ì ‘íŒ ìƒíƒœ */
        #buffInfo.collapsed #buffList {
            display: none;
        }

        /* í¼ì¹œ ìƒíƒœ */
        #buffInfo.expanded #buffList {
            display: flex;
        }

        /* í¼ì¹˜ë©´ í™”ì‚´í‘œ íšŒì „ */
        #buffInfo.expanded .buff-toggle {
            transform: rotate(180deg);
        }

        #buffInfo {
            background: var(--bg-sub);
            border:1px solid var(--border-main);
            border-radius:10px;
            padding:10px 14px;
        }

        #buffInfo h3 {
            margin: 0;
            color: var(--primary);
            font-size: 14px;
        }

        #buffList {
            display: flex;
            flex-wrap: wrap;
            font-size: 12px;
            gap: 4px;
        }

        .buff-pill {
            background: var(--primary);
            color: var(--text-accent);
            border-radius: 10px;
            padding: 8px 12px;
        }

        /* âœ… ì¦ê²¨ì°¾ê¸° ëª©ë¡ */
        #quickSelect {
            background: var(--bg-sub);
            border: 1px solid var(--border-main);
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            padding: 10px;
        }

        #quickSelect h3 {
            margin: 0;
            color: var(--primary);
            font-size: 14px;
        }

        #favoriteList {
            margin-top: 8px;
            display: none;
        }

        .favorite-item {
            display: inline-block;
            background: var(--bg-main);
            border: 1px solid var(--border-main);
            border-radius: 8px;
            padding: 6px 10px;
            margin: 3px;
            cursor: pointer;
            color: var(--primary);
            font-weight: 600;
            font-size: 13px;
        }

        /* âœ… í˜„ì¬ ì„ íƒëœ ì»¤í”¼ ê°•ì¡° ìŠ¤íƒ€ì¼ */
        .favorite-item.active {
            background: var(--primary);
            color: var(--text-accent);
            border-color: var(--primary);
        }

        .coffee-list {
            background: var(--bg-sub);
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .coffee-item {
            padding: 10px 14px;
            border-bottom: 1px solid var(--border-sub);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .coffee-item:last-child {
            border-bottom: none;
        }

        .star {
            font-size: 18px;
            color: var(--primary-light); /* ê¸°ë³¸ ì—°ë³´ë¼ìƒ‰ */
            cursor: pointer;
            margin-left: 8px;
        }

        .star.active {
            color: #ffd84d; /* í´ë¦­ ì‹œ ë…¸ë€ìƒ‰ */
        }

        /* ì»¤í”¼ ì •ë³´ ì¹´ë“œ */
        #coffeeInfo {
            position: relative;
            background: var(--bg-sub);
            border: 1px solid var(--border-main);
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            padding: 15px 20px 5px 20px;
            display: none;
        }

        #coffeeInfo .coffee-name {
            color: var(--primary);
            font-size: 18px;
            font-weight: 600;
        }

        #coffeeInfo .coffee-stat {
            background: var(--primary);
            color: var(--text-accent);
            border-radius: 10px;
            padding: 8px 12px;
        }

        #coffeeInfo p {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            font-size: 12px;
        }

        /* ì»¤í”¼ ì •ë³´ ì¹´ë“œ ì•ˆì˜ ì¦ê²¨ì°¾ê¸° ë³„ */
        #coffeeInfo .info-star {
            position: absolute;
            top: 2px;
            right: 4px;
            font-size: 22px;
            color: var(--primary-light); /* ê¸°ë³¸ ì—°ë³´ë¼ìƒ‰ */
            cursor: pointer;
            transition: 0.2s ease;
        }

        #coffeeInfo .info-star.active {
            color: #ffd84d; /* í´ë¦­ ì‹œ ë…¸ë€ìƒ‰ */
        }

        /* í‘œ ì˜ì—­ */
        #coffeeTable,
        #subTable {
            border-collapse: collapse;
            background: var(--bg-sub);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        #coffeeTable th, #coffeeTable td,
        #subTable th, #subTable td {
            border: 1px solid var(--border-main);
            padding: 4px;
            text-align: center;
            font-size: 10px;
        }

        #coffeeTable th,
        #subTable th {
            background: var(--bg-sub);
            color: var(--primary);
            font-weight: 600;
        }

        /* êµì°¨ ë°°ê²½ìƒ‰ (ì¤„ë¬´ëŠ¬ íš¨ê³¼) */
        #coffeeTable tbody tr:nth-child(odd),
        #subTable tbody tr:nth-child(odd) {
            background-color: var(--bg-main); /* í°ìƒ‰ */
        }

        #coffeeTable tbody tr:nth-child(even),
        #subTable tbody tr:nth-child(even) {
            background-color: var(--bg-sub); /* ì•„ì£¼ ì˜…ì€ ë³´ë¼ë¹› */
        }

        #loading {
            text-align: center;
            color: var(--primary);
            font-weight: 600;
            margin-top: 20px;
            display: none;
        }

        /* ===== ì„œë¸Œí˜ì´ì§€ ì»¨íŠ¸ë¡¤ ===== */
        #sortSelect {
            width: 100%;
            padding: 12px 14px;
            border-radius: 10px;
            border: 1px solid var(--border-sub);
            font-size: 15px;
            font-weight: 600;
            background: var(--bg-sub);
            color: var(--text-main);
            transition: 0.2s;
        }

        #sortSelect:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(90, 67, 152, 0.15);
            outline: none;
        }

        .sub-star {
            color: var(--primary-light);
            cursor: pointer;
        }

        .sub-star.active {
            color: #ffd84d;
        }

    </style>
    <link rel="stylesheet" href="../modules/helpModal.css"/>
    <link rel="stylesheet" href="../modules/menuToggle.css"/>
</head>
<body>

<div class="header-bar">
    <div style="display: flex; gap: 4px; align-items: center">
        <h1>ë°”ë¦¬ìŠ¤íƒ€</h1>
        <button id="helpBtn">?</button>
    </div>
    <button id="backBtn">ë’¤ë¡œê°€ê¸°</button>
</div>

<div id="controlBar">
    <div class="input-groups">
        <div class="input-group">
            <span>ì»¤í”¼ë§ˆë ˆ</span>
            <select id="levelSelect" class="level-select">
                <option value="0">ì„ íƒ</option>

                <optgroup label="ë£¨í‚¤">
                    <option value="1">ë£¨í‚¤ 1</option>
                    <option value="2">ë£¨í‚¤ 2</option>
                    <option value="3">ë£¨í‚¤ 3</option>
                    <option value="4">ë£¨í‚¤ 4</option>
                    <option value="5">ë£¨í‚¤ 5</option>
                    <option value="6">ë£¨í‚¤ 6</option>
                    <option value="7">ë£¨í‚¤ 7</option>
                    <option value="8">ë£¨í‚¤ 8</option>
                    <option value="9">ë£¨í‚¤ 9</option>
                </optgroup>

                <optgroup label="ì•„ë§ˆì¶”ì–´">
                    <option value="10">ì•„ë§ˆì¶”ì–´ 1</option>
                    <option value="11">ì•„ë§ˆì¶”ì–´ 2</option>
                    <option value="12">ì•„ë§ˆì¶”ì–´ 3</option>
                    <option value="13">ì•„ë§ˆì¶”ì–´ 4</option>
                    <option value="14">ì•„ë§ˆì¶”ì–´ 5</option>
                    <option value="15">ì•„ë§ˆì¶”ì–´ 6</option>
                    <option value="16">ì•„ë§ˆì¶”ì–´ 7</option>
                    <option value="17">ì•„ë§ˆì¶”ì–´ 8</option>
                    <option value="18">ì•„ë§ˆì¶”ì–´ 9</option>
                </optgroup>

                <optgroup label="í”„ë¡œ">
                    <option value="19">í”„ë¡œ 1</option>
                    <option value="20">í”„ë¡œ 2</option>
                    <option value="21">í”„ë¡œ 3</option>
                    <option value="22">í”„ë¡œ 4</option>
                    <option value="23">í”„ë¡œ 5</option>
                    <option value="24">í”„ë¡œ 6</option>
                    <option value="25">í”„ë¡œ 7</option>
                    <option value="26">í”„ë¡œ 8</option>
                    <option value="27">í”„ë¡œ 9</option>
                </optgroup>

                <optgroup label="ìŠ¤í˜ì…œ">
                    <option value="28">ìŠ¤í˜ì…œ 1</option>
                    <option value="29">ìŠ¤í˜ì…œ 2</option>
                    <option value="30">ìŠ¤í˜ì…œ 3</option>
                    <option value="31">ìŠ¤í˜ì…œ 4</option>
                    <option value="32">ìŠ¤í˜ì…œ 5</option>
                    <option value="33">ìŠ¤í˜ì…œ 6</option>
                    <option value="34">ìŠ¤í˜ì…œ 7</option>
                    <option value="35">ìŠ¤í˜ì…œ 8</option>
                    <option value="36">ìŠ¤í˜ì…œ 9</option>
                </optgroup>

                <optgroup label="ì›”ë“œ ë² ìŠ¤íŠ¸">
                    <option value="37">ì›”ë²  1</option>
                    <option value="38">ì›”ë²  2</option>
                    <option value="39">ì›”ë²  3</option>
                    <option value="40">ì›”ë²  4</option>
                    <option value="41">ì›”ë²  5</option>
                    <option value="42">ì›”ë²  6</option>
                    <option value="43">ì›”ë²  7</option>
                    <option value="44">ì›”ë²  8</option>
                    <option value="45">ì›”ë²  9</option>
                </optgroup>

                <optgroup label="ë§ˆìŠ¤í„°">
                    <option value="46">ë§ˆìŠ¤í„° 1</option>
                    <option value="47">ë§ˆìŠ¤í„° 2</option>
                    <option value="48">ë§ˆìŠ¤í„° 3</option>
                    <option value="49">ë§ˆìŠ¤í„° 4</option>
                    <option value="50">ë§ˆìŠ¤í„° 5</option>
                    <option value="51">ë§ˆìŠ¤í„° 6</option>
                    <option value="52">ë§ˆìŠ¤í„° 7</option>
                    <option value="53">ë§ˆìŠ¤í„° 8</option>
                    <option value="54">ë§ˆìŠ¤í„° 9</option>
                </optgroup>

                <optgroup label="ê·¸ëœë“œ ë§ˆìŠ¤í„°">
                    <option value="55">ê·¸ë§ˆ</option>
                </optgroup>
            </select>
        </div>
        <div class="input-group">
            <span>ì»¤í”¼ë¨¸ì‹ </span>
            <input type="number" id="countInput" placeholder="ìˆ˜ëŸ‰" min="1" max="25">
        </div>
    </div>
    <div id="buffInfo" class="collapsed">
        <div class="buff-header">
            <h3>ì ìš©ë²„í”„</h3>
            <span class="buff-toggle">â–¼</span>
        </div>
        <div id="buffList"></div>
    </div>
    <div>
        <input type="text" id="searchInput" placeholder="ì»¤í”¼ ì´ë¦„ ê²€ìƒ‰">
    </div>
</div>


    <!-- âœ… TOP5 / ì¦ê²¨ì°¾ê¸° ëª©ë¡ -->
    <div id="quickSelect">
        <h3>ì‹œê°„ ëŒ€ë¹„ ê²½í—˜ì¹˜ íš¨ìœ¨ TOP5</h3>
        <div id="recommendedItems"></div>

        <div id="favoriteList">
            <h3>ì¦ê²¨ì°¾ê¸°</h3>
            <div id="favoriteItems"></div>
        </div>
    </div>
<div class="mainPage">
    <div id="resultList" class="coffee-list">
        <div style='padding: 10px; color: var(--text-main);'>ë¹ ì§„ ì»¤í”¼ê°€ ìˆë‹¤ë©´ ë¬¸ì˜ ë¶€íƒë“œë¦½ë‹ˆë‹¤.</div>
    </div>

    <!-- âœ… ì»¤í”¼ ì •ë³´ ì¹´ë“œ -->
    <div id="coffeeInfo"></div>

    <table id="coffeeTable" style="display:none;">
        <thead>
        <tr>
            <th>ê°¯ìˆ˜</th>
            <th>ì†Œìš”ì‹œê°„</th>
            <th>ì›ë‘<br>ì†Œëª¨ëŸ‰</th>
            <th>íšë“<br>ê²½í—˜ì¹˜</th>
            <th>íšë“<br>ê³¨ë“œ</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<div class="subPage" style="display:none;">
    <div class="sub-control-bar">
        <select id="sortSelect">
            <option value="expPerTime">ì‹œê°„ ëŒ€ë¹„ ê²½í—˜ì¹˜ íš¨ìœ¨</option>
            <option value="goldPerTime">ì‹œê°„ ëŒ€ë¹„ ê³¨ë“œ íš¨ìœ¨</option>
            <option value="expPerBean">ì›ë‘ ëŒ€ë¹„ ê²½í—˜ì¹˜ íš¨ìœ¨</option>
            <option value="goldPerBean">ì›ë‘ ëŒ€ë¹„ ê³¨ë“œ íš¨ìœ¨</option>
            <option value="masterPerTime">ì‹œê°„ ëŒ€ë¹„ ë§ˆë ˆ íš¨ìœ¨</option>
            <option value="masterBase">ë§ˆë ˆ ê²½í—˜ì¹˜ íšë“ëŸ‰</option>
        </select>
    </div>

    <table id="subTable">
        <thead>
        <tr id="subHeaderRow">
            <th>â˜…</th>
            <th>ìˆœì„œ</th>
            <th>ì´ë¦„</th>
            <th>íŒë§¤ì‹œê°„</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>


<div id="loading">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

<!-- âœ… ë„ì›€ë§ ëª¨ë‹¬ -->
<div id="helpModal" class="login-overlay" style="display:none;">
    <div class="login-modal help-modal">
        <button id="closeHelpModal" class="closeBtn">âœ•</button>
        <h2 class="help-title">ë°”ë¦¬ìŠ¤íƒ€ ì‚¬ìš© ê°€ì´ë“œ</h2>

        <div id="helpPages" class="help-content">
            <div class="help-page page1">
                <b>ê¸°ë³¸ ì„¤ì •</b><br>
                1) ìƒë‹¨ ì…ë ¥ì¹¸ì—ì„œ <b>ì»¤í”¼íŒë§¤ ì†ë„</b>ì™€ <b>ì»¤í”¼ë¨¸ì‹  ìˆ˜ëŸ‰</b>ì„ ì…ë ¥í•˜ì„¸ìš”.<br>
                - íŒë§¤ì†ë„: 1ì‹œê°„ ë™ì•ˆ ì»¤í”¼ë¥¼ ëª‡ ì” íŒë§¤í•  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.<br>
                - ì»¤í”¼ë¨¸ì‹  ìˆ˜ëŸ‰: ë™ì‹œì— ì»¤í”¼ë¥¼ ë‚´ë¦´ ìˆ˜ ìˆëŠ” ê¸°ê³„ì˜ ê°œìˆ˜ì…ë‹ˆë‹¤.<br>
                - ì…ë ¥í•œ ê°’ì€ ìë™ìœ¼ë¡œ ì €ì¥ë˜ì–´ ë‹¤ìŒ ì ‘ì† ì‹œì—ë„ ìœ ì§€ë©ë‹ˆë‹¤.
            </div>

            <div class="help-page page2" style="display:none;">
                <b>ì»¤í”¼ ê²€ìƒ‰</b><br>
                2) ê²€ìƒ‰ì°½ì— ì»¤í”¼ ì´ë¦„ì´ë‚˜ ì¤„ì„ë§ì„ ì…ë ¥í•˜ë©´ í•´ë‹¹ ë©”ë‰´ë¥¼ ë°”ë¡œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                - ì˜ˆì‹œ: <b>ì•„ì´ìŠ¤ ì•„ë©”ë¦¬ì¹´ë…¸</b> â†’ <b>ì•„ì•„</b> ë˜ëŠ” <b>ì•„ì´ìŠ¤</b>ë¡œ ê²€ìƒ‰ ê°€ëŠ¥<br>
                - ì¼ì¹˜í•˜ëŠ” ì»¤í”¼ê°€ ì—†ìœ¼ë©´ ì•ˆë‚´ ë¬¸êµ¬ê°€ í‘œì‹œë©ë‹ˆë‹¤.<br>
                - ì»¤í”¼ë¥¼ í´ë¦­í•˜ë©´ ìƒì„¸ì •ë³´ ì¹´ë“œê°€ ì—´ë¦½ë‹ˆë‹¤.
            </div>

            <div class="help-page page3" style="display:none;">
                <b>ì»¤í”¼ ì •ë³´ í™•ì¸</b><br>
                3) ì„ íƒí•œ ì»¤í”¼ì˜ <b>ì›ë‘ ì†Œëª¨ëŸ‰</b>, <b>ê²½í—˜ì¹˜</b>, <b>ê³¨ë“œ</b> ì •ë³´ë¥¼ í•œëˆˆì— í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                - ê° í•­ëª©ì€ ì” ìˆ˜ì— ë”°ë¼ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.<br>
                - íŒë§¤ì†ë„ ë˜ëŠ” ë¨¸ì‹  ìˆ˜ëŸ‰ì„ ìˆ˜ì •í•˜ë©´ ì¦‰ì‹œ ë‹¤ì‹œ ê³„ì‚°ë©ë‹ˆë‹¤.<br>
                - í™”ë©´ í•˜ë‹¨ì˜ í‘œì—ëŠ” ë‹¤ì–‘í•œ íŒë§¤ ì¡°ê±´ì— ë”°ë¥¸ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.
            </div>

            <div class="help-page page4" style="display:none;">
                <b>ì¦ê²¨ì°¾ê¸°</b><br>
                4) ì»¤í”¼ ì´ë¦„ ì˜¤ë¥¸ìª½ì˜ <b>ë³„(â˜…)</b>ì„ ëˆŒëŸ¬ ì¦ê²¨ì°¾ê¸°ì— ë“±ë¡í•˜ì„¸ìš”.<br>
                - ìµœëŒ€ 5ê°œê¹Œì§€ ë“±ë¡ ê°€ëŠ¥í•˜ë©°, ëª©ë¡ì€ ìƒë‹¨ì— ë”°ë¡œ í‘œì‹œë©ë‹ˆë‹¤.<br>
                - ìì£¼ ê³„ì‚°í•˜ëŠ” ì»¤í”¼ë¥¼ ë“±ë¡í•´ë‘ë©´ ê²€ìƒ‰ ì—†ì´ ë°”ë¡œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                - ì¦ê²¨ì°¾ê¸° í•­ëª©ì˜ <b>ë³„(â˜…)</b>ì„ ë‹¤ì‹œ ëˆ„ë¥´ë©´ í•´ì œë©ë‹ˆë‹¤.
            </div>

            <div class="help-page page5" style="display:none;">
                <b>í‘œ ë³´ê¸°</b><br>
                5) í•˜ë‹¨ì˜ í‘œì—ì„œëŠ” ì„ íƒí•œ ì»¤í”¼ë¥¼ ê¸°ì¤€ìœ¼ë¡œ<br>
                ë¨¸ì‹  ìˆ˜ Ã— ì»¤í”¼ íŒë§¤ ì†ë„ì— ë”°ë¼ ì˜ˆìƒë˜ëŠ” ê²°ê³¼ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.<br>
                - ê° í–‰ì€ íŒë§¤ íšŸìˆ˜ë³„ë¡œ ì†Œìš”ì‹œê°„, ì›ë‘ ì†Œëª¨ëŸ‰, ê²½í—˜ì¹˜, ê³¨ë“œ íšë“ëŸ‰ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.<br>
                - íŒë§¤ ì†ë„ë‚˜ ë¨¸ì‹  ìˆ˜ë¥¼ ë³€ê²½í•˜ë©´ í‘œë„ ì¦‰ì‹œ ê°±ì‹ ë©ë‹ˆë‹¤.<br>
                - ë§ˆìŠ¤í„°ë ˆë²¨ì´ë‚˜ ì¶”ê°€ ê²½í—˜ì¹˜ëŠ” ë°˜ì˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
            </div>
        </div>

        <div>
            <div id="helpDots" class="help-dots"></div>
        </div>

        <!-- âœ… í˜ì´ì§€ë„¤ì´ì…˜ -->
        <div id="helpPagination" class="help-pagination">
            <button id="prevHelpPage" class="help-btn">ã€ˆ ì´ì „</button>
            <button id="nextHelpPage" class="help-btn">ë‹¤ìŒ ã€‰</button>
        </div>

        <div class="help-tip">ë‹¤ì‹œ ë³´ê³  ì‹¶ì„ ë•, í™”ë©´ ìƒë‹¨ì˜ <b>?</b> ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
    </div>
</div>

<script src="../theme/theme.js" type="module" defer></script>
<script type="module">
    import {menuData} from "../common/menuData.js";
    import {goToPage, COLORS} from "../common/utils.js";

    const LEVEL_RESULT = [
        /* 0 */  { speed:1800, ice:0, hot:0, latte:0, blended:0, tea:0 },

        /* ë£¨í‚¤ */
        /* 1 */  { speed:1800, ice:0, hot:0, latte:0, blended:0, tea:0 },
        /* 2 */  { speed:1800, ice:0, hot:0, latte:0, blended:0, tea:0 },
        /* 3 */  { speed:1872, ice:0, hot:0, latte:0, blended:0, tea:0 },
        /* 4 */  { speed:1872, ice:0, hot:0, latte:0, blended:0, tea:0 },
        /* 5 */  { speed:1872, ice:0, hot:0, latte:0, blended:0, tea:0 },
        /* 6 */  { speed:1872, ice:0, hot:15, latte:0, blended:0, tea:0 },
        /* 7 */  { speed:1872, ice:0, hot:15, latte:0, blended:0, tea:0 },
        /* 8 */  { speed:1944, ice:0, hot:15, latte:0, blended:0, tea:0 },
        /* 9 */  { speed:1944, ice:0, hot:15, latte:15, blended:0, tea:0 },

        /* ì•„ë§ˆì¶”ì–´ */
        /* 10 */ { speed:1944, ice:15, hot:15, latte:15, blended:0, tea:0 },
        /* 11 */ { speed:1944, ice:15, hot:15, latte:15, blended:0, tea:0 },
        /* 12 */ { speed:2070, ice:15, hot:15, latte:15, blended:0, tea:0 },
        /* 13 */ { speed:2070, ice:15, hot:15, latte:15, blended:15, tea:0 },
        /* 14 */ { speed:2070, ice:15, hot:15, latte:15, blended:15, tea:0 },
        /* 15 */ { speed:2070, ice:15, hot:15, latte:15, blended:15, tea:15 },
        /* 16 */ { speed:2070, ice:15, hot:15, latte:15, blended:15, tea:15 },
        /* 17 */ { speed:2070, ice:15, hot:15, latte:15, blended:15, tea:15 },
        /* 18 */ { speed:2196, ice:15, hot:30, latte:15, blended:15, tea:15 },

        /* í”„ë¡œ */
        /* 19 */ { speed:2196, ice:15, hot:30, latte:15, blended:15, tea:15 },
        /* 20 */ { speed:2340, ice:15, hot:30, latte:15, blended:15, tea:15 },
        /* 21 */ { speed:2340, ice:15, hot:30, latte:30, blended:15, tea:15 },
        /* 22 */ { speed:2340, ice:15, hot:30, latte:30, blended:15, tea:15 },
        /* 23 */ { speed:2340, ice:15, hot:30, latte:30, blended:30, tea:15 },
        /* 24 */ { speed:2340, ice:15, hot:30, latte:30, blended:30, tea:15 },
        /* 25 */ { speed:2340, ice:15, hot:30, latte:30, blended:30, tea:15 },
        /* 26 */ { speed:2340, ice:30, hot:30, latte:30, blended:30, tea:15 },
        /* 27 */ { speed:2340, ice:30, hot:30, latte:30, blended:30, tea:30 },

        /* ìŠ¤í˜ì…œ */
        /* 28 */ { speed:2520, ice:30, hot:30, latte:30, blended:30, tea:30 },
        /* 29 */ { speed:2520, ice:30, hot:30, latte:30, blended:30, tea:30 },
        /* 30 */ { speed:2700, ice:30, hot:30, latte:30, blended:30, tea:30 },
        /* 31 */ { speed:2700, ice:30, hot:30, latte:30, blended:30, tea:30 },
        /* 32 */ { speed:2916, ice:30, hot:30, latte:30, blended:30, tea:30 },
        /* 33 */ { speed:2916, ice:30, hot:30, latte:30, blended:30, tea:30 },
        /* 34 */ { speed:3132, ice:30, hot:30, latte:30, blended:30, tea:30 },
        /* 35 */ { speed:3132, ice:30, hot:30, latte:30, blended:30, tea:30 },
        /* 36 */ { speed:3132, ice:30, hot:30, latte:30, blended:30, tea:30 },

        /* ì›”ë²  */
        /* 37 */ { speed:3132, ice:30, hot:30, latte:30, blended:30, tea:30 },
        /* 38 */ { speed:3384, ice:30, hot:30, latte:30, blended:30, tea:30 },
        /* 39 */ { speed:3384, ice:30, hot:30, latte:30, blended:30, tea:30 },
        /* 40 */ { speed:3384, ice:30, hot:30, latte:30, blended:30, tea:30 },
        /* 41 */ { speed:3384, ice:30, hot:30, latte:30, blended:30, tea:30 },
        /* 42 */ { speed:3384, ice:30, hot:30, latte:30, blended:45, tea:30 },
        /* 43 */ { speed:3384, ice:30, hot:30, latte:30, blended:45, tea:30 },
        /* 44 */ { speed:3384, ice:30, hot:30, latte:30, blended:45, tea:30 },
        /* 45 */ { speed:3672, ice:30, hot:30, latte:30, blended:45, tea:30 },

        /* ë§ˆìŠ¤í„° */
        /* 46 */ { speed:3672, ice:30, hot:30, latte:30, blended:45, tea:30 },
        /* 47 */ { speed:3672, ice:30, hot:30, latte:30, blended:45, tea:30 },
        /* 48 */ { speed:3672, ice:30, hot:30, latte:30, blended:45, tea:30 },
        /* 49 */ { speed:3978, ice:30, hot:30, latte:30, blended:45, tea:30 },
        /* 50 */ { speed:4356, ice:30, hot:30, latte:30, blended:45, tea:30 },
        /* 51 */ { speed:4860, ice:30, hot:30, latte:30, blended:45, tea:30 },
        /* 52 */ { speed:4860, ice:30, hot:30, latte:30, blended:45, tea:30 },
        /* 53 */ { speed:4860, ice:30, hot:30, latte:30, blended:45, tea:30 },
        /* 54 */ { speed:5436, ice:30, hot:30, latte:30, blended:45, tea:30 },

        /* 55 */ { speed:5436, ice:30, hot:30, latte:30, blended:45, tea:30 }
    ];

    const STORAGE_KEYS = {
        SPEED: "coffeeSpeed",
        COUNT: "coffeeMachineCount",
        SELECTED_COFFEE: "selectedCoffee",
        FAVORITES: "favoriteCoffees"
    };

    const $countInput = $("#countInput");
    const $searchInput = $("#searchInput");
    const $resultList = $("#resultList");
    const $table = $("#coffeeTable");
    const $tbody = $("#coffeeTable tbody");
    const $coffeeInfo = $("#coffeeInfo");
    const $recommendedItems = $("#recommendedItems");
    const $favoriteList = $("#favoriteList");
    const $favoriteItems = $("#favoriteItems");

    const MAX_COUNT = 25;
    const TIME = 3600;

    const $levelSelect = $("#levelSelect");

    $levelSelect.on("change", () => {
        const level = Number($levelSelect.val());
        const data = LEVEL_RESULT[level];
        if (!data) return;

        savedSpeed = data.speed;
        localStorage.setItem("coffeeBarista-level", level);

        renderBuffInfo(level);
        clearAllTables();
        renderRecommended();

        const mode = localStorage.getItem("coffeeBarista-mode") || "normal";

        if (mode === "filter") {
            // âœ… ì„œë¸Œí˜ì´ì§€ì¼ ë•Œ
            renderSubTable();
        } else {
            // âœ… ë©”ì¸í˜ì´ì§€ì¼ ë•Œ
            const selected = getSavedCoffee();
            if (selected) {
                showCoffeeInfo(selected);
                showCoffeeTable(selected);
            }
        }
    });

    // âœ… íŒë§¤ì†ë„ / ë¨¸ì‹ ìˆ˜ëŸ‰ ë³µì›
    const savedLevel = Number(localStorage.getItem("coffeeBarista-level")) || 0;
    $levelSelect.val(savedLevel);

    let savedSpeed = LEVEL_RESULT[savedLevel].speed;
    let savedCount = parseInt(localStorage.getItem(STORAGE_KEYS.COUNT)) || "4";

    if (savedCount > MAX_COUNT) {
        savedCount = MAX_COUNT;
        localStorage.setItem(STORAGE_KEYS.COUNT, savedCount);
    } else if (savedCount < 0) {
        savedCount = 0;
        localStorage.setItem(STORAGE_KEYS.COUNT, savedCount);
    }

    if (savedCount) $countInput.val(savedCount);

    function clearAllTables() {
        $("#coffeeTable tbody").empty();
        $("#subTable tbody").empty();
    }

    function formatSecondsToTime(sec) {
        const total = Math.floor(sec);

        const hours = Math.floor(total / 3600);
        const minutes = Math.floor((total % 3600) / 60);
        const seconds = total % 60;

        if (hours > 0) {
            return `${hours}ì‹œê°„ ${String(minutes).padStart(2, "0")}ë¶„ ${String(seconds).padStart(2, "0")}ì´ˆ`;
        }

        if (minutes > 0) {
            return `${minutes}ë¶„ ${String(seconds).padStart(2, "0")}ì´ˆ`;
        }

        return `${seconds}ì´ˆ`;
    }

    function renderBuffInfo(level) {
        const buff = LEVEL_RESULT[level] || LEVEL_RESULT[0];

        const rows = [];

        // ì†ë„ëŠ” ê·¸ëŒ€ë¡œ
        rows.push(`<span class="buff-pill">ì†ë„ : ${buff.speed.toLocaleString()}</span>`);

        // ë‚˜ë¨¸ì§€ëŠ” + ë¶™ì—¬ì„œ
        rows.push(`<span class="buff-pill">ì•„ì´ìŠ¤ : +${buff.ice || 0}</span>`);
        rows.push(`<span class="buff-pill">í•« : +${buff.hot || 0}</span>`);
        rows.push(`<span class="buff-pill">ë¼ë–¼ : +${buff.latte || 0}</span>`);
        rows.push(`<span class="buff-pill">ë¸”ë Œë””ë“œ : +${buff.blended || 0}</span>`);
        rows.push(`<span class="buff-pill">í‹° : +${buff.tea || 0}</span>`);

        $("#buffList").html(rows.join(""));
    }

    $("#buffInfo").on("click", function () {
        const $this = $(this);
        $this.toggleClass("expanded collapsed");
    });

    renderBuffInfo(savedLevel);
    renderRecommended();
    renderFavorites();

    $countInput.on("input", updateAndRefresh);

    $searchInput.on("input", () => {
        const keyword = $searchInput.val().trim();
        const mode = localStorage.getItem("coffeeBarista-mode") || "normal";
        clearAllTables();

        if (mode === "filter") {
            // âœ… ì„œë¸Œí˜ì´ì§€ì¼ ë•Œ
            renderSubTable();
        } else {
            // âœ… ë©”ì¸í˜ì´ì§€ì¼ ë•Œ
            renderCoffeeList(keyword);
        }
    });

    function updateAndRefresh() {
        let count = Number($countInput.val()) || 0;

        // âœ… ìƒí•œê°’ ì´ˆê³¼ ì‹œ ìë™ êµì •
        if (count > MAX_COUNT) {
            count = MAX_COUNT;
            $countInput.val(count);
        } else if (count < 0) {
            count = 0;
            $countInput.val(count);
        }

        // âœ… ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ë„ ì •ì •ëœ ê°’ ì €ì¥
        localStorage.setItem(STORAGE_KEYS.COUNT, count + "");

        const selected = getSavedCoffee();
        const mode = localStorage.getItem("coffeeBarista-mode") || "normal";
        if (mode !== "filter" && selected) {
            showCoffeeInfo(selected);
            showCoffeeTable(selected);
        }
    }

    function renderCoffeeList(keyword = "") {
        $resultList.empty();
        if (!keyword) {
            $resultList.hide();
            return;
        }

        const lowerKeyword = keyword.trim().toLowerCase();

        const matched = menuData.filter(c => {
            const name = c.name.trim();
            const lowerName = name.toLowerCase();

            // âœ… 1) ì´ë¦„ì— ì§ì ‘ í¬í•¨ëœ ê²½ìš°
            if (lowerName.includes(lowerKeyword)) return true;

            // âœ… 2) ë‹¨ì–´ë³„ ì²« ê¸€ì ì¡°í•©ìœ¼ë¡œ ê²€ìƒ‰ (ì˜ˆ: ì•„ì´ìŠ¤ ì•„ë©”ë¦¬ì¹´ë…¸ â†’ "ì•„ì•„")
            const words = name.split(/\s+/);
            const initials = words.map(w => w[0]).join("").toLowerCase();
            if (initials.includes(lowerKeyword)) return true;

            return false;
        });

        if (matched.length === 0) {
            $resultList.show().html(`<div style='padding: 10px; color: ${COLORS.TXT_M}};'>ë¹ ì§„ ì»¤í”¼ê°€ ìˆë‹¤ë©´ ë¬¸ì˜ ë¶€íƒë“œë¦½ë‹ˆë‹¤.</div>`);
            return;
        }

        const favorites = getFavorites();

        matched.forEach(c => {
            const isFav = favorites.some(f => f.name === c.name);
            const $item = $(`
                <div class="coffee-item">
                    <span>${c.name}</span>
                    <span class="star ${isFav ? 'active' : ''}">â˜…</span>
                </div>
            `);

            $item.find(".star").on("click", (e) => {
                e.stopPropagation();
                toggleFavorite(c);
            });

            $item.on("click", () => selectCoffee(c));
            $resultList.append($item);
        });
        $resultList.show();
    }

    function selectCoffee(coffee) {
        const normalized = normalizeCoffee(coffee);
        localStorage.setItem(STORAGE_KEYS.SELECTED_COFFEE, JSON.stringify(normalized));
        $searchInput.val("");
        $resultList.empty().hide();
        showCoffeeInfo(normalized);
        showCoffeeTable(normalized);
        renderFavorites();
        renderRecommended();
    }

    function getSavedCoffee() {
        const data = localStorage.getItem(STORAGE_KEYS.SELECTED_COFFEE);
        if (!data) return null;

        return normalizeCoffee(JSON.parse(data));
    }

    // âœ… ì»¤í”¼ ì •ë³´ í‘œì‹œ
    function showCoffeeInfo(coffee) {
        $resultList.hide();

        const buffedExp = getBuffedExp(coffee);
        const isFav = getFavorites().some(f => f.name === coffee.name);
        $coffeeInfo.show().html(`
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <span class="coffee-name">${coffee.name}</span>
                    <span>( ${coffee.count.toLocaleString()}ì” )</span>
                </div>
                <span class="info-star ${isFav ? 'active' : ''}">â˜…</span>
            </div>
            <p>
                <span class="coffee-stat">ì›ë‘ : ${coffee.bean.toLocaleString()}</span>
                <span class="coffee-stat">ê²½í—˜ì¹˜ : ${buffedExp.toLocaleString()}</span>
                <span class="coffee-stat">ê³¨ë“œ : ${coffee.gold.toLocaleString()}</span>
            </p>
        `);

        $coffeeInfo.find(".info-star").on("click", () => {
            toggleFavorite(coffee);
            showCoffeeInfo(coffee); // ìƒíƒœ ì¦‰ì‹œ ê°±ì‹ 
        });
    }

    // âœ… í‘œ í‘œì‹œ
    function showCoffeeTable(coffee) {
        const speed = savedSpeed;
        const end = (Number(localStorage.getItem(STORAGE_KEYS.COUNT)) || 0) * 4;
        $tbody.empty();
        $table.show();

        if (!end) {
            $tbody.html(`<tr><td colspan="5" style="font-size:15px; padding:15px">ì»¤í”¼ë¨¸ì‹  ìˆ˜ëŸ‰ì„ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.</td></tr>`);
            return;
        }

        for (let i = end; i > 0; i--) {
            const totalSeconds = (coffee.count * i * 3600) / speed;
            const timeStr = formatSecondsToTime(totalSeconds);

            const beanUse = (coffee.bean * i).toLocaleString();
            const buffedExp = getBuffedExp(coffee);
            const expGain = (buffedExp * i).toLocaleString();
            const goldGain = (coffee.gold * coffee.count * i).toLocaleString();

            $tbody.append(`
                <tr>
                    <td>${i}</td>
                    <td>${timeStr}</td>
                    <td>${beanUse}</td>
                    <td>${expGain}</td>
                    <td>${goldGain}</td>
                </tr>
            `);
        }
    }

    function normalizeCoffee(coffee) {
        // ì´ë¯¸ tag ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
        if (coffee.tag) return coffee;

        // menuDataì—ì„œ ë™ì¼í•œ ì´ë¦„ ì°¾ê¸°
        const origin = menuData.find(m => m.name === coffee.name);

        // ëª» ì°¾ìœ¼ë©´ ê·¸ëŒ€ë¡œ ë°˜í™˜ (ë°©ì–´)
        if (!origin) return coffee;

        // tag ë³´ì •í•´ì„œ ë°˜í™˜
        return {
            ...coffee,
            tag: origin.tag
        };
    }

    function renderRecommended() {
        const level = Number($levelSelect.val()) || 0;

        // íš¨ìœ¨ ê³„ì‚° â†’ expPerTime ê¸°ì¤€ ì •ë ¬
        const ranked = menuData
            .map(m => ({ ...m, e: calcEfficiency(m) }))
            .sort((a, b) => b.e.expPerTime - a.e.expPerTime)
            .slice(0, 5); // TOP 5

        const selected = getSavedCoffee();
        const selectedName = selected ? selected.name : null;

        $recommendedItems.empty();

        ranked.forEach((c, idx) => {
            const shortName = shortenName(c.name);
            const isActive = c.name === selectedName;

            const $item = $(`
                <div class="favorite-item ${isActive ? "active" : ""}"
                     title="${c.name}">
                    ${shortName}
                </div>
            `);

            $item.on("click", () => selectCoffee(c));
            $recommendedItems.append($item);
        });
    }

    // âœ… ì¦ê²¨ì°¾ê¸° ê´€ë ¨ í•¨ìˆ˜
    function getFavorites() {
        const data = localStorage.getItem(STORAGE_KEYS.FAVORITES);
        if (!data) return [];

        const list = JSON.parse(data);

        // âœ… ê³¼ê±° ë°ì´í„° ë³´ì •
        const normalized = list.map(normalizeCoffee);

        // ğŸ”’ í•œ ë²ˆ ë³´ì •í–ˆìœ¼ë©´ ë‹¤ì‹œ ì €ì¥
        localStorage.setItem(STORAGE_KEYS.FAVORITES, JSON.stringify(normalized));

        return normalized;
    }

    function saveFavorites(list) {
        localStorage.setItem(STORAGE_KEYS.FAVORITES, JSON.stringify(list));
    }

    function toggleFavorite(coffee) {
        let list = getFavorites();
        const exists = list.some(f => f.name === coffee.name);
        if (exists) {
            list = list.filter(f => f.name !== coffee.name);
        } else {
            if (list.length >= 5) {
                alert("ì¦ê²¨ì°¾ê¸°ëŠ” ìµœëŒ€ 5ê°œê¹Œì§€ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
                return;
            }
            list.push(normalizeCoffee(coffee));
        }
        saveFavorites(list);
        renderFavorites();
        renderCoffeeList($searchInput.val().trim());
    }

    // âœ… ì»¤í”¼ ì´ë¦„ ì¤„ì„ë§ ìƒì„±
    function shortenName(name) {
        const parts = name.trim().split(/\s+/);
        if (parts.length === 1) return name; // ë‹¨ì–´ í•˜ë‚˜ë©´ ê·¸ëŒ€ë¡œ
        return parts.map(p => p[0]).join("");
    }

    function renderFavorites() {
        const list = getFavorites();
        if (list.length === 0) {
            $favoriteList.hide();
            return;
        }

        const selected = getSavedCoffee(); // âœ… í˜„ì¬ ì„ íƒëœ ì»¤í”¼
        const selectedName = selected ? selected.name : null;

        $favoriteItems.empty();
        list.forEach(c => {
            const shortName = shortenName(c.name);
            const $fav = $(`<div class="favorite-item" title="${c.name}">${shortName}</div>`);

            // âœ… í˜„ì¬ ì„ íƒëœ ì»¤í”¼ë©´ active ìŠ¤íƒ€ì¼ ì¶”ê°€
            if (c.name === selectedName) {
                $fav.addClass("active");
            }

            $fav.on("click", () => selectCoffee(c));
            $favoriteItems.append($fav);
        });
        $favoriteList.show();
    }

    const viewConfigMap = {
        expPerTime: {
            headers: ["íš¨ìœ¨"],
            keys: ["expPerTime"],
            sort: ["expPerTime"]
        },
        goldPerTime: {
            headers: ["íš¨ìœ¨"],
            keys: ["goldPerTime"],
            sort: ["goldPerTime"]
        },
        expPerBean: {
            headers: ["íš¨ìœ¨"],
            keys: ["expPerBean"],
            sort: ["expPerBean"]
        },
        goldPerBean: {
            headers: ["íš¨ìœ¨"],
            keys: ["goldPerBean"],
            sort: ["goldPerBean"]
        },
        masterPerTime: {
            headers: ["íš¨ìœ¨"],
            keys: ["masterPerTime"],
            sort: ["masterPerTime"]
        },
        masterBase: {
            headers: ["íš¨ìœ¨"],
            keys: ["masterBase"],
            sort: ["masterBase"]
        }
    };

    // âœ… ì•Œë¦¼ ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼
    $(document).on("click", ".baristaModeBtn", function () {
        const $area = $(".floating-btn-area");
        const $toggle = $(".floating-toggle");
        $area.addClass("collapsed");
        $toggle.show();
        $toggle.text("â–²");
        toggleMode();
    });

    function toggleMode() {
        const current = localStorage.getItem("coffeeBarista-mode") || "normal";
        const next = current === "filter" ? "normal" : "filter";

        localStorage.setItem("coffeeBarista-mode", next);
        applySavedMode();
    }

    function applySavedMode() {
        const savedMode = localStorage.getItem("coffeeBarista-mode") || "normal";
        clearAllTables();

        if (savedMode === "filter") {
            $(".mainPage").hide();
            $(".subPage").show();
            renderSubTable();
            $(".baristaModeBtn").text("ì¼ë°˜ëª¨ë“œ");
        } else {
            $(".mainPage").show();
            $(".subPage").hide();

            const selected = getSavedCoffee();
            if (selected) {
                showCoffeeInfo(selected);
                showCoffeeTable(selected);
            }

            $(".baristaModeBtn").text("í•„í„°ëª¨ë“œ");
        }
    }

    function getExpBuffByTag(tag) {
        const level = Number($levelSelect.val()) || 0;
        const buff = LEVEL_RESULT[level] || LEVEL_RESULT[0];

        // âœ… all íƒœê·¸ë©´ ê°€ì¥ ë†’ì€ ë²„í”„ í•˜ë‚˜ ì ìš©
        if (tag === "all") {
            return Math.max(
                buff.ice || 0,
                buff.hot || 0,
                buff.latte || 0,
                buff.blended || 0,
                buff.tea || 0
            );
        }

        // âœ… ì¼ë°˜ íƒœê·¸
        return buff[tag] || 0;
    }

    function getBuffedExp(menu) {
        return menu.exp + getExpBuffByTag(menu.tag);
    }

    function calcEfficiency(menu) {
        const { gold, count, exp, bean, tag } = menu;

        // âœ… íƒœê·¸ì— ë§ëŠ” ê³ ì • ê²½í—˜ì¹˜ ë³´ë„ˆìŠ¤
        const buffedExp = getBuffedExp(menu);
        const safeCount = count || 1;

        return {
            expPerTime: (buffedExp * (savedSpeed / safeCount)) / TIME,
            goldPerTime: gold / (TIME / savedSpeed),
            expPerBean: (buffedExp / bean) * 100,
            goldPerBean: ((gold * safeCount) / bean) * 100,
            masterPerTime: (bean * 0.03) * (savedSpeed / safeCount) / TIME,
            masterBase: bean * 0.03,
            brewTime: TIME / (savedSpeed / safeCount),
        };
    }

    const $subBody = $("#subTable tbody");
    const $sortSelect = $("#sortSelect");
    $sortSelect.on("change", renderSubTable);

    function renderSubTable() {
        const keyword = $searchInput.val()?.toLowerCase() || "";
        const selectKey = $sortSelect.val();
        const config = viewConfigMap[selectKey];
        const favorites = getFavorites();

        // âœ… í—¤ë” ì¬êµ¬ì„±
        const $headerRow = $("#subHeaderRow");
        $headerRow.find("th:gt(3)").remove();

        config.headers.forEach(h => {
            $headerRow.append(`<th>${h}</th>`);
        });

        // âœ… 1. ì „ì²´ ë°ì´í„° ì •ë ¬ ë¨¼ì €
        const sortedAll = menuData
            .map(m => ({ ...m, e: calcEfficiency(m) }))
            .sort((a, b) => {
                for (const key of config.sort) {
                    if (b.e[key] !== a.e[key]) {
                        return b.e[key] - a.e[key];
                    }
                }
                return 0;
            })
            // âœ… ì›ë˜ ìˆœë²ˆ ë¶€ì—¬
            .map((m, index) => ({
                ...m,
                originIndex: index + 1
            }));

        // âœ… 2. ê²€ìƒ‰ì€ í•„í„°ë§Œ
        const filtered = sortedAll.filter(m =>
            m.name.toLowerCase().includes(keyword)
        );

        $subBody.empty();

        filtered.forEach(m => {
            let valueCells = "";
            const isFav = favorites.some(f => f.name === m.name);
            const starClass = isFav ? "active" : "";

            config.keys.forEach(k => {
                const value = m.e[k].toFixed(2);
                valueCells += `<td>${value}</td>`;
            });

            $subBody.append(`
                <tr class="sub-row" data-name="${m.name}">
                    <td>
                        <span class="sub-star ${starClass}" data-name="${m.name}">â˜…</span>
                    </td>
                    <td>${m.originIndex}</td>
                    <td>${m.name}</td>
                    <td>${formatSecondsToTime(m.e.brewTime)}</td>
                    ${valueCells}
                </tr>
            `);
        });

        $subBody.find("tr").off("click").on("click", function () {
            const name = $(this).data("name");
            const coffee = menuData.find(m => m.name === name);
            if (!coffee) return;

            toggleFavorite(coffee);
            renderSubTable();
        });
    }

    function waitForBaristaToggleBtn() {
        const observer = new MutationObserver(() => {
            const $btn = $(".baristaModeBtn");
            if ($btn.length) {
                applySavedMode();   // âœ… ë²„íŠ¼ ìƒì„± í›„ ì‹¤í–‰
                observer.disconnect(); // âœ… í•œ ë²ˆë§Œ ì‹¤í–‰
            }
        });

        observer.observe(document.body, {
            childList: true,
            subtree: true
        });
    }

    // âœ… DOM ì¤€ë¹„ë˜ë©´ ê°ì‹œ ì‹œì‘
    $(document).ready(() => {
        waitForBaristaToggleBtn();
    });
</script>
<script src="../modules/helpModal.js" type="module" defer></script>
<script src="../modules/menuToggle.js" type="module" defer></script>
</body>
</html>